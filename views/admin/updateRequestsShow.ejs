<% include ../partials/header %>

<div class="container col-md-6 pb-5">
    <h1>Pending Update Requests (<%= updateRequests.length %>)</h1> 
    
    <% if(!showAllUpdateRequests) { %>
        <a class="btn btn-info" href="/admin/updateRequests?showAllUpdateRequests=true">Show All Completed</a>
    <% } else { %>
        <a class="btn btn-info" href="/admin/updateRequests?showAllUpdateRequests=false">Hide All Completed</a>
    <% } %>
    
<div class="row">
    <% updateRequests.forEach(function(updateRequest){ %>
        <% if(!updateRequest.isDone) { %>
            <div class="mb-2 nopadding">
                <div class="card card-grey">
                    <div class="pl-3 pr-3 pt-3 pb-3">
                        <div class="card-title d-flex flex-row flex-wrap align-items-center justify-content-between">
                            <div class="d-flex flex-row flex-wrap align-items-baseline">
                                <strong>
                                    <a class="mr-1" href="/users/<%= updateRequest.author._id %>">
                                        <img class="" height="40" width="40" src="<%= process.env.CLOUDINARY_URL_START %>c_fill,h_100,w_100,f_auto,q_auto,r_max<%= updateRequest.author.avatar.slice(46) %>" alt="Update Request author avatar">
                                        <%= updateRequest.author.displayName %>
                                    </a>
                                </strong>
                            </div>
                            <div class="d-flex flex-row flex-grow-1 justify-content-end"><em><%= moment(updateRequest.createdAt).fromNow() %></em></div>
                        </div>
                        <div class="card-text comment-text rounded pl-2 pr-2 pt-2 pb-2 mb-2" style="background-color: #8accd7"><%= updateRequest.text %></div>
                        <div>Activity Link: 
                            <% activities.forEach(function(activity){ %>
                                <% activity.updateRequests.forEach(function(activityUpdateRequest){ %>
                                    <% if(String(activityUpdateRequest) === String(updateRequest.id)) { %>
                                        <% activityId = activity._id %>
                                        <a href="/activities/<%= activity._id %>"><%= activity.name %></a>
                                    <% } %>
                                <% }) %>
                            <% }) %>
                        </div>
                    </div>
                </div>
            </div>
        <% } else if(showAllUpdateRequests) { %>
        <!-- If update request isDone -->
            <!-- If url query param "showAllUpdateRequests" is set to true -->
            <div class="col-md-12 mb-2 nopadding">
                <div class="card card-green">
                    <div class="pl-3 pr-3 pt-3 pb-3">
                        <div class="card-title d-flex flex-row flex-wrap align-items-center justify-content-between">
                            <div class="d-flex flex-row flex-wrap align-items-baseline">
                                <strong>
                                    <a class="mr-1" href="/users/<%= updateRequest.author._id %>">
                                        <img class="" height="40" width="40" src="<%= process.env.CLOUDINARY_URL_START %>c_fill,h_100,w_100,f_auto,q_auto,r_max<%= updateRequest.author.avatar.slice(46) %>" alt="Update Request author avatar">
                                        <%= updateRequest.author.displayName %>
                                    </a>
                                </strong>
                            </div>
                            <div class="d-flex flex-row flex-grow-1 justify-content-end"><em><%= moment(updateRequest.createdAt).fromNow() %></em></div>
                        </div>
                        <div class="card-text comment-text rounded pl-2 pr-2 pt-2 pb-2" style="background-color: #8accd7"><%= updateRequest.text %></div>
                        <hr>
                        <div class="d-flex flew-column flex-wrap justify-content-between mt-2">
                            
                            <p>
                                <strong>
                                    <a class="mr-1" href="/users/<%= updateRequest.isDoneUser._id %>">
                                        <img class="" height="40" width="40" src="<%= process.env.CLOUDINARY_URL_START %>c_fill,h_100,w_100,f_auto,q_auto,r_max<%= updateRequest.isDoneUser.avatar.slice(46) %>" alt="Update Request isDone user avatar">
                                        <%= updateRequest.isDoneUser.displayName %>
                                    </a>
                                </strong>
                            
                                selected "<strong><%= updateRequest.isDoneValue %></strong>" <%= moment(updateRequest.isDoneDate).fromNow() %>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        <% } %>
    <% }); %>

</div>
    
</div>

<% include ../partials/footer %>