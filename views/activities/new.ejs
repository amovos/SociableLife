<% include ../partials/header %>

<div class="container pb-5">
    <div class="row justify-content-center">
        <div class="col-md-12">
            <header class="jumbotron d-flex flex-column align-items-center">
                <h1>Add an Activity</h1>
                
                <% if(currentUser) { %>
       			    <a href="/users/<%= currentUser.id %>" class="nav-link nopadding d-flex flex-row align-items-center">
    					<img class="mr-1" height="40" width="40" src="<%= process.env.CLOUDINARY_URL_START %>c_fill,h_100,w_100,f_auto,q_auto,r_max<%= currentUser.avatar.slice(46) %>" alt="current user avatar">
    					<%= currentUser.displayName %>
    				</a>
				<% } else { %>
				    <div class="d-flex flex-row align-items-baseline">
				        <i class="fas fa-2x fa-user mr-2"></i> Guest User
				    </div>
				<% } %>
            </header>
        </div>
        
        <div class="col-xs-12 col-sm-10 col-md-8 col-lg-6 col-xl-6">
            <% if(!currentUser) { %>
                <div class="alert alert-warning" role="alert">
        		    <p>
        			    You're creating this activity as a guest so you won't be able to edit it once it's been submitted. This activity will be listed under the "Sociable Life Community" user.
        			    <br><br>
        			    If you'd like to add this activity to your own profile please <a href="/login?return_url=/activities/new&activityName=<%= activityName %>">login</a> or <a href="/inviteCode?return_url=/activities/new&activityName=<%= activityName %>">sign up</a> for FREE.
        			</p>
                </div>
            <% } %>
            
            <form id="createActivityForm" action="/activities/newReviewPopulate" method="POST">
                <div class="form-group">
                    <label for="name">Activity Name *</label>
                    <input class="form-control" type="text" name="activity[name]" id="name" placeholder="e.g. Woodlarks Campsite" value="<%= activityName %>" required>
                </div>
                
                <div class="form-group">
                    <label for="summary">Summary (140 characters?) *</label>
                    <textarea class="form-control" rows="3" name="activity[summary]" id="summary" placeholder="e.g. a short description of the activity" required><%= activitySummary %></textarea>
                </div>
                
                <div class="form-group">
                    <label for="location">Location *</label>
                    <input class="form-control" type="text" name="activity[location]" id="location" placeholder="e.g. Woodlarks Campsite, Farnham, Surrey" value="<%= activityLocation %>" required>
                </div>
                <div class="form-group">
                    <label for="description">Description *</label>
                    <textarea class="form-control" rows="6" name="activity[description]" id="description" placeholder="e.g. A fully accessible campsite with an outdoor heated pool and a zipline!" required><%= activityDescription %></textarea>
                </div>
                
                <!-- Error message box -->
                <div id="errorMessageContainer" class="container" style="display: none;">
                    <div class="row justify-content-end">
                            <div id="errorMessageDiv" class="alert alert-warning fade show col-md-8" role="alert">
                        </div>
                    </div>
                </div>
                
                <div class="container">
                    <div class="form-group">
                        <div class="row justify-content-end">
                            <button class="col-sm-6 btn btn-lg btn-primary btn-block">Review and add picture</button>
                        </div>
                    </div> 
                </div>
                
            </form>
            
            <a href="javascript:history.back()">Go Back</a>
        </div>
    </div>
</div>

<script type='text/javascript'>
    
    var passedChecks;
    
    $(document).ready(function(){
        passedChecks = false;
    });
    
    $("#createActivityForm").submit(function(event) {
        
        /* stop form from submitting normally if all checks haven't passed */
        if(!passedChecks){
            event.preventDefault();
        } else {
            return;
        }
        
        /* get the action attribute from the <form action=""> element */
        var $form = $( this ),
            url = "/activities/newReview";
        
        /* Send the data using post*/
        var posting = $.post( url, {    name: $('#name').val(), 
                                        summary: $('#summary').val(), 
                                        location: $('#location').val(), 
                                        description: $('#description').val()
                                    } 
                            );
                            
        /* Process returned result */
        posting.done(function( data ) {
            //if a location has been returned then update the location field
            if(data.location) {
                $('#location').val(data.location);
            }
            
            if(data.type === "error") {
                //show error message box with error message
                $('#errorMessageContainer').show();
                $('#errorMessageDiv').html(data.message);
            } else if (data.type === "success") {
                //submit form
                passedChecks = true;
                $("#createActivityForm").submit();
            }
        });
    });
</script>

<% include ../partials/footer %>