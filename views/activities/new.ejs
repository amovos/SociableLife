<% include ../partials/header %>

<div class="container pb-5">
    <div class="row justify-content-center">
        <div class="col-md-12">
            <header class="jumbotron d-flex flex-column align-items-center">
                <h1>Add an Activity</h1>
                
                <% if(currentUser) { %>
       			    <a href="/users/<%= currentUser.id %>" class="nav-link nopadding d-flex flex-row align-items-center">
    					<img class="mr-1" height="40" width="40" src="<%= process.env.CLOUDINARY_URL_START %>c_fill,h_100,w_100,f_auto,q_auto,r_max<%= currentUser.avatar.slice(46) %>" alt="current user avatar">
    					<%= currentUser.displayName %>
    				</a>
				<% } else { %>
				    <div class="d-flex flex-row align-items-baseline">
				        <i class="fas fa-2x fa-user mr-2"></i> Guest User
				    </div>
				<% } %>
            </header>
        </div>
        
        <div class="col-xs-12 col-sm-10 col-md-8 col-lg-6 col-xl-6">
            <% if(!currentUser) { %>
                <div class="alert alert-warning" role="alert">
        		    <p>
        			    You're creating this activity as a guest so you won't be able to edit it once it's been submitted. This activity will be listed under the "Sociable Life Community" user.
        			    <br><br>
        			    If you'd like to add this activity to your own profile please <a href="/login?return_url=/activities/new&activityName=<%= activityName %>">login</a> or <a href="/inviteCode?return_url=/activities/new&activityName=<%= activityName %>">sign up</a> for FREE.
        			</p>
                </div>
            <% } %>
            
            <form id="createActivityForm" action="/activities/newReviewPopulate" method="POST">
                <div class="form-group">
                    <label for="name">Activity Name *</label>
                    <input class="form-control" type="text" name="activity[name]" id="name" placeholder="e.g. Woodlarks Campsite" value="<%= activityName %>" required>
                </div>
                
                <div class="form-group">
                    <label for="summary">Summary (140 characters?) *</label>
                    <textarea class="form-control" rows="3" name="activity[summary]" id="summary" placeholder="e.g. a short description of the activity" required><%= activitySummary %></textarea>
                </div>
                
                <div class="form-group">
                    <label for="description">Description *</label>
                    <textarea class="form-control" rows="6" name="activity[description]" id="description" placeholder="e.g. A fully accessible campsite with an outdoor heated pool and a zipline!" required><%= activityDescription %></textarea>
                </div>
                
                <div class="form-group">
                    <label for="location">Location *</label>
                    <input class="form-control" type="text" name="activity[location]" id="location" placeholder="e.g. Woodlarks Campsite, Farnham, Surrey" value="<%= activityLocation %>" required>
                </div>
                
                <div class="form-group">
                    <label for="name">Ages *</label>
                    <select id="age" class="form-control" name="activity[age]" required>
                        <option disabled selected value> -- Select an option -- </option>
                        <option value="All Ages" <% if(activityAge === "All Ages") { %>selected="selected" <% } %>>All Ages</option>
                        <option value="Adults" <% if(activityAge === "Adults") { %>selected="selected" <% } %>>Adults</option>
                        <option value="Children" <% if(activityAge === "Children") { %>selected="selected" <% } %>>Children</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="when">When *</label>
                    <input class="form-control" type="text" name="activity[when]" id="when" placeholder="e.g. Every Tuesday at 7pm" value="<%= activityWhen %>" required>
                </div>
                
                <div class="form-group">
                    <label for="name">Cost *</label>
                    <input class="form-control" type="text" name="activity[price]" id="price" placeholder="e.g. Â£5 per session or Free!" value="<%= activityPrice %>" required>
                </div>
                
                <div class="form-group">
                    <label for="frequency">Type *</label>
                    <select id="frequency" class="form-control" name="activity[frequency]" required>
                        <option disabled selected value> -- Select an option -- </option>
                        <option value="Daily Activities" <% if(activityFrequency === "Daily Activities") { %>selected="selected" <% } %>>Daily Activities</option>
                        <option value="Weekly Activities" <% if(activityFrequency === "Weekly Activities") { %>selected="selected" <% } %>>Weekly Activities</option>
                        <option value="Monthly Activities" <% if(activityFrequency === "Monthly Activities") { %>selected="selected" <% } %>>Monthly Activities</option>
                        <option value="Annual Activities" <% if(activityFrequency === "Annual Activities") { %>selected="selected" <% } %>>Annual Activities</option>
                        <option value="One-Off Activities" <% if(activityFrequency === "One-Off Activities") { %>selected="selected" <% } %>>One-Off Activities</option>
                        <option value="Book Yourself" <% if(activityFrequency === "Book Yourself") { %>selected="selected" <% } %>>Book Yourself</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="contactEmail">Contact Email (optional)</label>
                    <input class="form-control" type="email" name="activity[contactEmail]" id="contactEmail" placeholder="" value="<%= activityContactEmail %>">
                </div>
                
                <div class="form-group">
                    <label for="contactNum">Contact Number (optional)</label>
                    <input class="form-control" type="text" name="activity[contactNum]" id="contactNum" placeholder="" value="<%= activityContactNum %>">
                </div>
                
                <% if(currentUser) { %>
                    <div class="container card bg-warning mb-3">
                        <div class="form-group mr-2 ml-2 mt-2">
                            <div class="row justify-content-center align-items-center">
                                <label class="checkbox-container pr-0" for="isOwner">
                                    <strong>Do you help to run or organise this activity?</strong>
                                    <br>
                                    If you tick this box then your profile will show as one of the "owners" of this activity.
                                    <input class="checkbox-input" id="isOwner" type="checkbox" name="activity[isOwner]" <% if(activityIsOwner) { %>checked<% } %>/>
                                    <span class="checkmark border mt-1"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                <% } %>
                
                <!-- Error message box -->
                <div id="errorMessageContainer" class="container" style="display: none;">
                    <div class="row justify-content-end">
                            <div id="errorMessageDiv" class="alert alert-warning fade show col-md-8" role="alert">
                        </div>
                    </div>
                </div>
                
                <div class="container">
                    <div class="form-group">
                        <div class="row justify-content-end">
                            <button class="col-md-7 btn btn-lg btn-primary btn-block">Review and add picture</button>
                        </div>
                    </div> 
                </div>
                
            </form>
            
            <a href="javascript:history.back()">Go Back</a>
        </div>
    </div>
</div>

<script type='text/javascript'>
    
    var passedChecks;
    
    $(document).ready(function(){
        passedChecks = false;
    });
    
    $("#createActivityForm").submit(function(event) {
        
        /* stop form from submitting normally if all checks haven't passed */
        if(!passedChecks){
            event.preventDefault();
        } else {
            return;
        }
        
        /* get the action attribute from the <form action=""> element */
        var $form = $( this ),
            url = "/activities/newReview";
        
        /* Send the data using post*/
        var posting = $.post( url, {    name: $('#name').val(), 
                                        summary: $('#summary').val(), 
                                        location: $('#location').val(), 
                                        description: $('#description').val(),
                                        age: $('#age').val(),
                                        when: $('#when').val(),
                                        price: $('#price').val(),
                                        frequency: $('#frequency').val(),
                                        contactEmail: $('#contactEmail').val(),
                                        contactNum: $('#contactNum').val()
                                    } 
                            );
                            
        /* Process returned result */
        posting.done(function( data ) {
            //if a location has been returned then update the location field
            if(data.location) {
                $('#location').val(data.location);
            }
            
            if(data.type === "error") {
                //show error message box with error message
                $('#errorMessageContainer').show();
                $('#errorMessageDiv').html(data.message);
            } else if (data.type === "success") {
                //submit form
                passedChecks = true;
                $("#createActivityForm").submit();
            }
        });
    });
</script>

<% include ../partials/footer %>